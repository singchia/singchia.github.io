##序言
- 独立提呈
- 编号7348
- 类别：信息类
- ISSN：2070-1721
- 相关人员：
	- M. Mahalingam@Storvisor
	- D. Dutt@Cumulus Networks
	- K. Duda@Arista
	- P. Agarwal@Broadcom
	- L. Kreeger@Cisco
	- T. Sridhar@VMware
	- M. Bursell@Intel
	- C.Wright@RedHat
- 时间：2014.08

#虚拟扩展局域网：用三层网络实现的虚拟二层overlay网络框架
##摘要
本提呈描述了VXLAN，VXLAN用来满足多租户使用的数据中心overlay网络的需求。 该框架和相关协议可以用于云服务提供商以及企业级数据中心。 本提呈也描述了部署VXLAN对于互联网社区的优势。
##提呈状态
本提呈并不是互联网标准跟踪文档；而是用来公布协议信息。  

本提呈是对RFC系列的贡献，独立与其他RFC分支。 RFC的编辑们认为该文档不涉及实施和部署且文档具有一定的严谨性，因此可以公布。 所有RFC提呈不做为任何互联网候选标准，详情见RFC5741第2节。  

本提呈的现状、勘误以及反馈可以从[此处](http://www.rfc-editor.org/info/rfc7348)获取。
##版权说明
作者为序言相关人员，版权属于2014 IEIF Trust，保留所有权利。  

This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents in effect on the date of publication of this document.  

请仔细阅读本提呈，本提呈描述了读者的权利以及限制。
##目录
1. 介绍
	- 1.1. 缩写和定义
2. 习惯用法
3. VXLAN问题陈述
	- 3.1. 最小生成树协议和vlan数目范围带来的限制
	- 3.2. 多租户环境
	- 3.3. ToR交换机mac表耗尽
4. VXLAN
	- 4.1. 虚拟机间单播
	- 4.2. 广播和映射到多播
	- 4.3. 物理设施要求
5. VXLAN帧格式
6. VXLAN部署场景
	- 6.1. 内部vlan标签处理
7. 安全意见
8. IANA意见
9. 引用
	- 9.1. 正式引用
	- 9.2. 非正式引用
10. 致谢

##1. 介绍
在物理设施上服务虚拟化的需求越来越重要。 一台物理服务器上的虚拟机可以有自己的mac地址。 大量虚拟机之间的通信以及与交换机之间的连接会消耗以太网上交换机大量的mac地址。  
  
如果数据中心的虚拟机放到各自的vlan中，vlan的数量也会大大增加，甚至需要好几千个，当前的vlan数量限制为4096，肯定是不足的。    

数据中心又要求服务多租户，每一个都要求隔离网络，使用物理设施隔离太烧钱，所以网络管理员可以想办法在共享网络上隔离出虚拟网络来。 在这个场景下，普遍会遇到mac地址和vlan id之间的绑定肯定在多用户之间是冲突的。  


对于2层物理网络的虚拟环境来说，一个重要的需求是数据中心甚至跨数据中心的二层网络可扩展，以便于计算、网络和存储资源的分配。 这样的网络下，传统的生成树协议下的回环拓扑结构会导致大量的不可用连接。  

最后一个场景是网络操作者更喜欢用ip来做物理设备之间的连接（比如，为了防止大量物理链路被忽略，使用Equal-Cost Multipath(ECMP)来实现多路径扩展）。 即使在这种情况下，二层网络模型在内部虚拟机交流上仍是需要保留的。  

以上场景引起了overlay网络的需求，VXLAN overlay网络将虚拟机之间的数据封装进mac流量内，以构建逻辑上的通道。  

本提呈详细说明了VXLAN以适用上述需求，也说明了互联网社区部署VXLAN的优势。  
###1.1. 缩写和定义
|缩写|定义|
| --- | --- |
|ACL|Access Control List, 访问控制列表|
|ECMP|Equal-Cost Multipath, 等价多路径|
|IGMP| Internet Group Management Protocol, 互联网组播管理协议|
|IHL|Internet Header Length, 互联网头部长度|
|MTU|Maximum Transmission Unit, 最大传输单元|
|PIM|Protocol Independent Multicast, 协议无关组播?|
|SPB|Shortest Path Bridging, 最短路径桥接|
|STP|Spanning Tree Protocol， 生成树协议|
|ToR|Top of Rack，柜顶|
|TRILL|Transparent Interconnection of Lots of Links, 大量链路的透明连接？|
|VLAN|Virtual Local Area Network, 虚拟局域网|
|VM|Virtual Machine 虚拟机|
|VNI|VXLAN Network Identifier, VXLAN网络标识|
|VETP|VXLAN Tunnel End Point, 发起或者结束VXLAN通道的实体|
|VXLAN|Virtual eXtensible Local Area Network, 虚拟扩展局域网|
|VXLAN Segment|虚拟机交流的VXLAN二层overlay网络|
|VXLAN Gateway|VXLAN之间发送流量的实体|

##2. 习惯用法
关键词"MUST必须", "MUST NOT必须不能", "REQUIRED要求", "SHALL最好要", "SHALL NOT最好不要", "SHOULD 应该", "SHOULD NOT不应该", "RECOMMENDED建议", "MAY可能"以及"OPTIONAL可选"这些词汇，描述在文档([RFC2119](https://tools.ietf.org/html/rfc2119))中。

##3. VXLAN问题陈述
本节提供更多关于VXLAN方面的细节，关注点在数据中心的网络设施和相关问题上。
###3.1. 生成树导致的限制和VLAN的范围
当前二层网络使用IEEE 802.1D生成树协议(STP)去避免可选多路径引起的网络回环。STP会放弃使用某些链路来避免数据帧的重复拷贝和回环。一些网络中心操作员会觉得在使用STP的情况下设备空闲是一种资源浪费。而且STP引起的部分链路不可用还会影响故障恢复。不过最近有一些新进展，比如TRILL协议([RFC6325](https://tools.ietf.org/html/rfc6325))和SPB被提出，用来规避STP引起的一些问题。此外STP还可以用服务器配置来解决，同一个机架上的服务器处于同一个子网，不同的机架不同的子网，不过这个方法跟虚拟机二层网络通信模型有冲突。**_最后一段翻译译者存在疑惑。_**
数据中心二层网络的一个关键特性是使用虚拟局域网来隔绝广播域，以太帧中12比特的VLAN ID用来将二层网络隔离为多个广播域。即使最多只能有4096个,VLAN事实上已经服务了很多的数据中心。随着虚拟化的增长，这个限制已经快不能满足需求了。此外，STP的存在也限制了VLAN可用数。虚拟化基础上的多租户环境加速了更大数量VLAN的需求，详见3.3节

###3.2. 多租户环境
云计算给多租户环境提供了按需弹性资源供给。最典型的案例就是云服务商在一套物理设施上给多客户或多用户提供弹性服务。  
一个租户网络流量的独立性可以通过二层或者三层网络来解决。对于二层网络有VLANs来隔离流量 -- 比如一个租户直接由VLAN来区分。不过因为租户的数量太多，4094个VLAN常常不够用。而且还有每个租户需要多个VLAN的情况。  
另一个相关问题就是跨仓**(_cross-pod_)**扩展，一个仓一般包括一到多个附带着网络和存储的服务器。租客可能开始只用一个仓，随着扩展，可能开始需要其他仓，尤其是其他仓根本没有被充分使用。这个场景就需要可以动态扩展的二层网络了。
